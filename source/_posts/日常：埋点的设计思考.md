---
title: 日常：业务埋点的设计和思考
date: 2023-04-23 19:52:19
tags:
  - 每日思考&问题记录
  - 设计模式
---

这次我负责将埋点接入到我们的业务，我是这么做的：
所有的埋点字段由 ued 提供-》我维护一个大枚举，将 excel 表中的枚举写入-》然后再维护一个业务 Map，业务 Map 中的 key 值构成比较复杂，可能是路由，也可能是某些业务中存在枚举的 key，他的目的是为了方便直接从业务中取得埋点字段的类型，但是在有了两层 Map 的情况下又不可避免的出现了第三种 map

第三种 map 的原因：
首先每个埋点的值都是唯一的，但是有一个组件，完全相同的组件使用在不同的页面，每个页面的埋点都是不一样的，因此我需要新建立一个和之前第二层 Map 不同的数据结构来存储

这个方案给同事听了之后说多增加第一层维护 Map 的成本，这个应该交给平台，他应该存在一个接口，可以返回所有的已经配置好的埋点，而不是我手动去维护第一层的 Map
![组件截图](/picture/20230423.png)

如此设计虽然我写的时候很舒服，但是多一层抽象就带来很高的维护成本，**\*后来者学习重新学习一遍你的流程**，像是埋点这种很通用的，应该就给一个发送出去不应该构建更高级的抽象
这难免让我思考一个问题，何时抽象，何时不抽象

### 1、抽象的好处>耦合的后果

这个视频提到了这个观点[视频](https://www.bilibili.com/video/BV1TT411m7Ny/?spm_id_from=333.880.my_history.page.click)。抽象并非百利而无一害，作者观点说抽象越高你的耦合就会越高，其实我觉得可以理解为过度抽象化带来的可维护性变差增加复杂性和开发时间

### 2、抽象 != 提取重复的代码

需要甄别重复代码，真的是因为他们是一套设计机制，还是因为仅仅是重复代码才做抽象，其实理解开来还是可维护性，未来是代码否增加拓展

### 3、项目规模和共通认识

如果是一个大型项目，合理的抽象可以帮助团队协作和代码的可维护性。在小型项目中，尤其是在埋点这种有一定共同性的设计中，要避免不必要的抽象，确保抽象的实施有实际的好处。




总结：
我们把这几个观点抽象化就是：
```
重复代码：如果发现某些代码片段在多个地方重复出现，可以考虑将其抽象为一个函数或组件以提高复用性。


可读性：如果代码段过于复杂，抽象成一个函数或组件可以提高可读性和维护性。


项目规模：如果是一个大型项目，合理的抽象可以帮助团队协作和代码的可维护性。


预测变化：如果预期某些功能可能发生变化，适当的抽象有助于减少对整体代码的影响。


避免过度抽象：过度抽象可能导致难以理解的代码结构，尤其是在小型项目中。要避免不必要的抽象，确保抽象的实施有实际的好处。
```


简单判断方法：


如果出现两段代码完全重复，或者共享同一个处理逻辑，那么首先问问自己，如果其中一个因为某种需求变更而发生变化，是否必然会引起另一处也发生相同的改变？如果答案是肯定的，而且这种重复或共享次数在当前大于等于3，那么就要做抽象，否则一定不要做